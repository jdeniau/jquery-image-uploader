void 0!==typeof jQuery&&function(g){g.fn.imageUploader=function(h){function r(b){b.preventDefault();b.stopPropagation();return a.onDragLeave()}function s(b){b.preventDefault();b.stopPropagation();return a.onDragEnter()}function t(b){b.preventDefault();b.stopPropagation();return a.onDragOver()}function u(b){b.preventDefault();b.stopPropagation();n(b.originalEvent.dataTransfer.files);return a.onDrop()}function p(){a.thumbnails&&(e=a.thumbnails.div.find('[data-upload-status="waiting"]:first'),e.attr("data-upload-status",
"uploading"),e.append(g('<div class="progress" />').append(g("<div />"))))}function v(b){b.lengthComputable&&((!e||0==e.length)&&p(),e&&e.find(".progress > div").width(100*b.loaded/b.total+"%"));return a.onUploadProgress(b)}function w(b){j=!0;var g=null;e&&(e.find(".progress > div").width("100%"),g=e,e=null);a.afterUpload(b.target.response,g);k()}function q(){j=!0;e=null;a.error("upload failed");k()}function x(){j=!0;e=null;a.error("upload canceled");k()}function k(){if(j&&0<l.length){file=l.shift();
j=!1;var b=file;if(c.upload&&a.beforeUpload()){var g=new FormData;g.append("file",b);c.open("POST",a.url);c.upload.addEventListener("progress",v,!1);c.addEventListener("loadstart",p,!1);c.addEventListener("load",w,!1);c.addEventListener("error",q,!1);c.addEventListener("abort",x,!1);c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.send(g)}}}function y(b){b.preventDefault();b.stopPropagation();n(b.target.files);return a.onFilesSelected()}function n(b){if(window.File&&window.FileReader&&window.FileList&&
window.FormData)for(var e=null,c=0;c<b.length;c++){if(0<a.maxFileSize&&file.size>a.maxFileSize)return a.error("the file you are trying to upload is too big");if(e=!a.allowDuplicate)a:{e=b[c];for(i in m)if(f=m[i],e.name==f.name&&e.size==f.size&&e.type==f.type){e=!0;break a}e=!1}if(e)return a.error("the file you are trying to upload has already been sent");a.thumbnails&&(a.thumbnails.div.file=b[c],e=new FileReader,e.onload=function(b){b=b.target.result;var d=new Image;d.src=b;g(d).hide();var e=g("<div />").attr("data-upload-status",
"waiting").css({overflow:"hidden",position:"relative"}).append(d);d.onload=function(){var b=a.thumbnails.width,c=a.thumbnails.height,h=d.width/d.height;a.thumbnails.crop&&0<b&&0<c?(e.width(b),e.height(c),g(d).css("position","absolute"),b/c>h?"zoom"==a.thumbnails.crop?(d.width=b,d.height=b/h,g(d).css("top","-"+parseInt((d.height-c)/2)+"px")):(d.width=c*h,d.height=c,g(d).css("left",parseInt((b-d.width)/2)+"px")):"zoom"==a.thumbnails.crop?(d.height=c,d.width=c*h,g(d).css("left","-"+parseInt((d.width-
b)/2)+"px")):(d.width=b,d.height=c/h,g(d).css("top",parseInt((c-d.height)/2)+"px"))):(0<b?d.width=b:0<c&&(d.width=c*h),0<c?d.height=c:0<b&&(d.height=b/h));g(d).css({width:d.width,height:d.height});g(d).show("slow")};a.thumbnails.div.append(e)},e.readAsDataURL(b[c]));try{var h=b[c];m.push(h);l.push(h);k()}catch(j){q()}}else alert("files api not supported")}var a=g.extend({},g.fn.imageUploader.defaults,h);a.dropZone=g(this);var j=!0,l=[],m=[],e=null,c=new XMLHttpRequest;null!=a.dropZone&&(a.dropZone.on("dragleave",
r),a.dropZone.on("dragenter",s),a.dropZone.on("dragover",t),a.dropZone.on("drop",u));null!=a.fileField&&(a.dropZone.on("click",function(){a.fileField.trigger("click")}),"string"==typeof a.fileField&&(a.fileField=g(a.fileField)),a.fileField.on("change",y),!0==a.hideFileField&&a.fileField.hide());a.thumbnails&&("object"!=typeof a.thumbnails&&(h=null,"string"==typeof a.thumbnails&&(h=g(a.thumbnails)),a.thumbnails={div:h,width:null,height:null}),"string"==typeof a.thumbnails.div&&(a.thumbnails.div=g(a.thumbnails.div)),
"object"==typeof a.thumbnails&&void 0==a.thumbnails.div&&(a.thumbnails.div=null),null==a.thumbnails.div&&(a.thumbnails.div=g('<div class="fileUploadThumbnails" />'),a.dropZone.after(a.thumbnails.div)));return this};g.fn.imageUploader.defaults={fileField:null,hideFileField:!0,url:null,thumbnails:{div:null,width:null,height:null},maxFileSize:0,allowDuplicate:!1,onFilesSelected:function(){return!1},onDragLeave:function(){return!1},onDragEnter:function(){return!1},onDragOver:function(){return!1},onDrop:function(){return!1},
onUploadProgress:function(){return!1},beforeUpload:function(){return!0},afterUpload:function(){return!1},error:function(g){alert(g)},debug:!1}}(jQuery);